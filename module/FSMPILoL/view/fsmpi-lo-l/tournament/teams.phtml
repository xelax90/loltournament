<?php
define('DEBUG', false);
define('ADMIN', false);
define('DDRAGON_VERSION', '4.19.2');
// TODO Login
/*
$idAnmeldung = null;
if(!empty($_GET['id']))
	$idAnmeldung = LoLDB::escape($_GET['id']);
*/
?>
<div class="anmeldung teams">
	<div class="content">
		<ul>
			<li style="width: 100%; float: none;">
				<div class="header">
					<b>Login</b>
				</div>
				<div class="article">
					<form action="teams.html" method="GET">
						<input type="text" placeholder="Code" name="id" style="float: left;">
						<input type="submit" value="Login" style="height: 21px; margin: 2px 0;">
						<?php if(DEBUG) : ?>
						<input type="hidden" name="test" value="">
						<?php endif;?>
					</form>
				</div>
			</li>
			<?php
				$tournament = $this->tournament;
				foreach($tournament->getGroups() as $group) : 
					$c = 0;
					foreach($group->getTeams() as $team):
						if($team->getIsBlocked())
							continue;
						// If ID is set
						$isIDAnmeldungTeam = false;
						/* TODO
						if(!empty($idAnmeldung)){
							foreach($team->players as $player){
								if($player->urlid == $idAnmeldung){
									$isIDAnmeldungTeam = true;
								}
							}
						}
						if(substr($team->teamname, 0, 4) == "Sub_")
							continue;
						*/
						$hasCaptain = false;
						foreach($team->getPlayers() as $player){
							if($player->getIsCaptain())
								$hasCaptain = true;
						}
				?>
				<li style="margin-right: <?= (1 - $c % 2) * 20 ?>px; <?= empty($idAnmeldung) || ADMIN ? '' : "width: 920px; margin-right: 0px;" ?> ">
					<div class="header" <?= DEBUG && $hasCaptain ? 'style="border-color: green;"' : '' ?>>
						<b><img style="width: 52px; vertical-align: middle; margin-right: 10px;" src="<?= $this->basePath() ?>/img/summoner_icons/<?= $team->getIcon() ?>"><?php echo $team->getName() ?></b>
						<?= ADMIN ? '<div style="clear: left">'.$team->getAnsprechpartner().'</div>' : ''; ?>
					</div>
					<div class="article">
						<div class="players">
							<?php $players = $team->getPlayers()->toArray(); ?>
							<?php usort($players, function($a, $b){return !$a->getIsCaptain() && !$b->getIsCaptain() ? 0 : ($a->getIsCaptain() ? -1 : 1); }) ?>
							<?php foreach($players as $player): ?>
								<div class="player" style="margin: 0  0 10px 0; background-image: url('http://ddragon.leagueoflegends.com/cdn/<?= DDRAGON_VERSION ?>/img/profileicon/<?= $player->getAnmeldung()->getSummonerdata()->getProfileIconId() ?>.png'); <?= empty($idAnmeldung) ? '' : "min-height: 57px; padding-top: 0px;" ?>">
									<?php if($isIDAnmeldungTeam || ADMIN || (!empty($idAnmeldung) && $player->getIsCaptain())) : ?>
									<div class="player_summonername <?= $player->getIsCaptain() ? 'captain' : '' ?>"><?= $player->getAnmeldung()->getName() ?></div>
									<div class="player_rankedWins"><?= $player->getAnmeldung()->getEmail() ?></div>
									<?php endif; ?>
									<div class="player_summonername <?= $player->getIsCaptain() ? 'captain' : '' ?>"><?= $player->getAnmeldung()->getSummonerName() ?></div>
									<div class="player_rankedWins">Ranked: <?= $player->getAnmeldung()->getSummonerdata()->getRankedWins() ?> Siege</div>
									<div class="player_level">Level <?= $player->getAnmeldung()->getSummonerdata()->getLevel() ?>, <?= $player->getAnmeldung()->getSummonerdata()->getTier() ?></div>
									<div class="player_normalWins">Normal: <?= $player->getAnmeldung()->getSummonerdata()->getNormalWins() ?> Siege</div>
									<?php if($player->getIsCaptain()) : ?>
									<div class="player_subborder"></div>
									<?php endif; ?>
								</div>
							<?php endforeach; ?>
						</div>
					</div>
				</li>
				<?php
					$c++;
					endforeach;
				endforeach;
			?>
			<?php if(empty($idAnmeldung) && false) : ?>
			<li style="width: 920px; margin-right: 0px;">
				<div class="header">
					<b>Ersatzspieler</b>
				</div>
				<div class="article">
					<div class="players">
						<?php foreach($tournament->groups[count($tournament->groups) - 1]->teams as $team) : ?>
							<?php if(substr($team->teamname, 0, 4) != "Sub_") continue; ?>
							<?php foreach($team->players as $player): ?>
								<div class="player" style="margin: 0  0 10px 0; background-image: url('http://ddragon.leagueoflegends.com/cdn/<?= DDRAGON_VERSION ?>/img/profileicon/<?= $player->profileIconID ?>.png')">
									<?php if(!empty($idAnmeldung) || ADMIN) : ?>
									<div class="player_summonername"><?= $player->name ?></div>
									<div class="player_rankedWins"><?= $player->mail ?></div>
									<?php endif; ?>
									<div class="player_summonername"><?= $player->summonername ?></div>
									<div class="player_rankedWins">Ranked: <?= $player->rankedWins ?> Siege</div>
									<div class="player_level">Level <?= $player->level ?>, <?= $player->tier ?></div>
									<div class="player_normalWins">Normal: <?= $player->normalWins ?> Siege</div>
								</div>
							<?php endforeach; ?>
						<?php endforeach; ?>
					</div>
				</div>
			</li>
			<?php endif; ?>
		</ul>
	</div>
</div>
